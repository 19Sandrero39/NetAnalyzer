use std::io::{self, Write};
use std::net::Ipv4Addr;

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Ğ’ÑĞ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ²Ğ²Ğ¾Ğ´Ğ° Ñ ĞºĞ¾Ğ½ÑĞ¾Ğ»Ğ¸
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
/// Ğ¡Ñ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ ÑÑ‚Ñ€Ğ¾ĞºÑƒ Ğ²Ğ²Ğ¾Ğ´Ğ° Ğ¾Ñ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ñ ĞºĞ¾Ğ½ÑĞ¾Ğ»Ğ¸, Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°Ñ Ğ·Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¹ `prompt`.
///
/// ### ĞÑ€Ğ³ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹
///
/// * `prompt` - Ğ¡Ñ‚Ñ€Ğ¾ĞºĞ¾Ğ²Ñ‹Ğ¹ ÑÑ€ĞµĞ·, Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµĞ¼Ñ‹Ğ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¿ĞµÑ€ĞµĞ´ Ğ²Ğ²Ğ¾Ğ´Ğ¾Ğ¼.
///
/// ### Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚
///
/// `String` - Ğ¡Ñ‚Ñ€Ğ¾ĞºĞ°, Ğ²Ğ²ĞµĞ´ĞµĞ½Ğ½Ğ°Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¼, Ñ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ°Ğ¼Ğ¸ Ğ² Ğ½Ğ°Ñ‡Ğ°Ğ»Ğµ Ğ¸ ĞºĞ¾Ğ½Ñ†Ğµ.
pub fn input(prompt: &str) -> String {
    let mut buf: String = String::new();
    print!("{}", prompt);
    io::stdout().flush().unwrap();
    io::stdin().read_line(&mut buf).unwrap();
    buf.trim().to_string()
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Ğ Ğ°ÑÑ‡Ñ‘Ñ‚ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ² Ğ¿Ğ¾Ğ´ÑĞµÑ‚Ğ¸ Ğ¿Ğ¾ IP Ğ¸ Ğ¼Ğ°ÑĞºĞµ
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
/// Ğ—Ğ°Ğ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°ĞµÑ‚ Ñƒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ IP-Ğ°Ğ´Ñ€ĞµÑ Ğ¸ Ğ¼Ğ°ÑĞºÑƒ Ğ¿Ğ¾Ğ´ÑĞµÑ‚Ğ¸, Ğ·Ğ°Ñ‚ĞµĞ¼ Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµÑ‚
/// Ñ€Ğ°Ğ·Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ¿Ğ¾Ğ´ÑĞµÑ‚Ğ¸, Ñ‚Ğ°ĞºĞ¸Ğµ ĞºĞ°Ğº ÑĞµÑ‚ĞµĞ²Ğ¾Ğ¹ Ğ°Ğ´Ñ€ĞµÑ, Ğ´Ğ»Ğ¸Ğ½Ñƒ Ğ¿Ñ€ĞµÑ„Ğ¸ĞºÑĞ°,
/// ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ñ…Ğ¾ÑÑ‚Ğ¾Ğ², Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¸ Ğ¼Ğ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ°Ğ´Ñ€ĞµÑĞ° Ñ…Ğ¾ÑÑ‚Ğ¾Ğ², Ğ¸ ÑˆĞ»ÑĞ·.
///
/// ### Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚
///
/// ĞšĞ¾Ñ€Ñ‚ĞµĞ¶, ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ°Ñ‰Ğ¸Ğ¹:
/// * `Ipv4Addr` - Ğ’Ğ²ĞµĞ´ĞµĞ½Ğ½Ñ‹Ğ¹ IP-Ğ°Ğ´Ñ€ĞµÑ.
/// * `Ipv4Addr` - Ğ’Ğ²ĞµĞ´ĞµĞ½Ğ½Ğ°Ñ Ğ¼Ğ°ÑĞºĞ° Ğ¿Ğ¾Ğ´ÑĞµÑ‚Ğ¸.
/// * `Ipv4Addr` - Ğ¡ĞµÑ‚ĞµĞ²Ğ¾Ğ¹ Ğ°Ğ´Ñ€ĞµÑ.
/// * `Ipv4Addr` - ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ°Ğ´Ñ€ĞµÑ Ñ…Ğ¾ÑÑ‚Ğ°.
/// * `Ipv4Addr` - ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ°Ğ´Ñ€ĞµÑ Ñ…Ğ¾ÑÑ‚Ğ°.
/// * `Ipv4Addr` - ĞĞ´Ñ€ĞµÑ ÑˆĞ»ÑĞ·Ğ°.
/// * `u32` - Ğ”Ğ»Ğ¸Ğ½Ğ° Ğ¿Ñ€ĞµÑ„Ğ¸ĞºÑĞ°.
/// * `u32` - ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ñ…Ğ¾ÑÑ‚Ğ¾Ğ².
///
/// ### ĞŸĞ°Ğ½Ğ¸ĞºĞ°
///
/// ĞŸĞ°Ğ½Ğ¸ĞºÑƒĞµÑ‚, ĞµÑĞ»Ğ¸ Ğ²Ğ²ĞµĞ´ĞµĞ½Ğ½Ñ‹Ğ¹ IP-Ğ°Ğ´Ñ€ĞµÑ Ğ¸Ğ»Ğ¸ Ğ¼Ğ°ÑĞºĞ° Ğ¿Ğ¾Ğ´ÑĞµÑ‚Ğ¸ Ğ½Ğµ ÑĞ²Ğ»ÑÑÑ‚ÑÑ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ°Ğ¼Ğ¸ IPv4.
pub fn get_network() -> (
    Ipv4Addr,
    Ipv4Addr,
    Ipv4Addr,
    Ipv4Addr,
    Ipv4Addr,
    Ipv4Addr,
    u32,
    u32,
) {
    println!("\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—");
    println!("â•‘ Â  âš™ï¸ Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ IP-Ğ°Ğ´Ñ€ĞµÑ (Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ñ Ğ¿Ñ€ĞµÑ„Ğ¸ĞºÑĞ¾Ğ¼ /) Â  â•‘");
    println!("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
    let ip_input: String = input("ğŸ”¹ Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ IP-Ğ°Ğ´Ñ€ĞµÑ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ 192.168.0.1 Ğ¸Ğ»Ğ¸ 192.168.0.1/24): ");
    println!("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");

    let (ip, mask, prefix_len): (Ipv4Addr, Ipv4Addr, u32) = if ip_input.contains('/') {
        // CIDR-Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚: IP/Ğ¿Ñ€ĞµÑ„Ğ¸ĞºÑ
        let parts: Vec<&str> = ip_input.split('/').collect();
        if parts.len() != 2 {
            panic!("âŒ ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ IP/Ğ¿Ñ€ĞµÑ„Ğ¸ĞºÑ!");
        }
        let ip: Ipv4Addr = parts[0].parse().expect("âŒ ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ IP-Ğ°Ğ´Ñ€ĞµÑ!");
        let prefix_len: u32 = parts[1].parse().expect("âŒ ĞĞµĞ²ĞµÑ€Ğ½Ğ°Ñ Ğ´Ğ»Ğ¸Ğ½Ğ° Ğ¿Ñ€ĞµÑ„Ğ¸ĞºÑĞ°!");

        if prefix_len > 32 {
            panic!("âŒ ĞŸÑ€ĞµÑ„Ğ¸ĞºÑ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ Ğ¾Ñ‚ 0 Ğ´Ğ¾ 32!");
        }

        let mask_u32: u32 = if prefix_len == 0 {
            0
        } else {
            u32::MAX << (32 - prefix_len)
        };

        let mask: Ipv4Addr = Ipv4Addr::from(mask_u32);
        (ip, mask, prefix_len)
    } else {
        // ĞšĞ»Ğ°ÑÑĞ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚: IP Ğ¸ Ğ¼Ğ°ÑĞºĞ°
        let ip: Ipv4Addr = ip_input.parse().expect("âŒ ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ IP-Ğ°Ğ´Ñ€ĞµÑ!");
        let mask_str: String = input("ğŸ”¹ Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ¼Ğ°ÑĞºÑƒ Ğ¿Ğ¾Ğ´ÑĞµÑ‚Ğ¸ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ 255.255.255.0): ");
        let mask: Ipv4Addr = mask_str.parse().expect("âŒ ĞĞµĞ²ĞµÑ€Ğ½Ğ°Ñ Ğ¼Ğ°ÑĞºĞ°!");
        let prefix_len: u32 = u32::from(mask).count_ones();
        (ip, mask, prefix_len)
    };

    // Ğ”Ğ°Ğ»ĞµĞµ ĞºĞ°Ğº Ñ€Ğ°Ğ½ÑŒÑˆĞµ:
    let ip_u32: u32 = u32::from(ip);
    let mask_u32: u32 = u32::from(mask);
    let network_u32: u32 = ip_u32 & mask_u32;
    let network: Ipv4Addr = Ipv4Addr::from(network_u32);
    let host_count: u32 = if prefix_len < 31 {
        2u32.pow(32 - prefix_len) - 2
    } else {
        0
    };
    let min_host: Ipv4Addr = Ipv4Addr::from(network_u32 + 1);
    let broadcast_u32: u32 = network_u32 | !mask_u32;
    let max_host: Ipv4Addr = if host_count > 0 {
        Ipv4Addr::from(broadcast_u32 - 1)
    } else {
        network
    };
    let gateway: Ipv4Addr = min_host;

    (
        ip, mask, network, min_host, max_host, gateway, prefix_len, host_count,
    )
}
